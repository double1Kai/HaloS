## 计数器
常用的是8253，内部有3个独立的计数器，分别是0~2，端口号为0x40~0x42，完全相同，相互独立
8253是减法计数器，从初值寄存器中得到初值，随时钟变化递减

- 计数器0：产生时钟信号，用于产生时钟中断，减到0则发生一次中断，可以控制时间片间隔
- 计数器1：用于DRAM的定时刷新
- 计数器2：用于内部扬声器发出不同频率的声音

## 8253 控制字

控制字寄存器，端口号 0x43，是 8 位寄存器，控制字寄存器也成为模式控制寄存器，用于指定计数器的 工作方式、读写格式 及 数制。

控制字结构：

| 7   | 6   | 5   | 4   | 3   | 2   | 1   | 0   |
| --- | --- | --- | --- | --- | --- | --- | --- |
| SC1 | SC0 | RL1 | RL0 | M2  | M1  | M0  | BCD |


- SC(Select Counter) 0 ~ 1：计数器选择位
    - 00 计数器 0
    - 01 计数器 1
    - 10 计数器 2
    - 11 无效
- RL(Read Load) 0 ~ 1：读写操作位
    - 00 锁存数据，供 CPU 读
    - 01 只读写低字节
    - 10 只读写高字节
    - 11 先读写低字节，后读写高字节
- M (Mode) 0 ~ 2：模式选择
    - 000：模式 0
    - 001：模式 1
    - x10：模式 2
    - x11：模式 3
    - 100：模式 4
    - 101：模式 5
- BCD：(Binary Coded Decimal) 码
    - 0 表示二进制计数器
    - 1 二进制编码的十进制计数器

## 模式

- 模式 0：计数结束时中断
- 模式 1：硬件可重触发单稳方式
- 模式 2：比率发生器，用于分频
- 模式 3：方波发生器
- 模式 4：软件触发选通
- 模式 5：硬件触发选通

## 蜂鸣器
- `/a` 发出一段声音

## 时间
COMS的端口号为0x70和0x71
- out 0x70 偏移值
- in 0x71 读取指定信息

| 地址偏移值  | 内容说明                    |
| ----------- | --------------------------- |
| 0x00        | 当前秒值 (实时钟)           |
| 0x01        | 闹钟秒值                    |
| 0x02        | 当前分钟 (实时钟)           |
| 0x03        | 闹钟分钟值                  |
| 0x04        | 当前小时值 (实时钟)         |
| 0x05        | 闹钟小时值                  |
| 0x06        | 一周中的当前天 (实时钟)     |
| 0x07        | 一月中的当日日期 (实时钟)   |
| 0x08        | 当前月份 (实时钟)           |
| 0x09        | 当前年份 (实时钟)           |
| 0x0a        | RTC 状态寄存器 A            |
| 0x0b        | RTC 状态寄存器 B            |
| 0x0c        | RTC 状态寄存器 C            |
| 0x0d        | RTC 状态寄存器 D            |
| 0x0e        | POST 诊断状态字节           |
| 0x0f        | 停机状态字节                |
| 0x10        | 磁盘驱动器类型              |
| 0x11        | 保留                        |
| 0x12        | 硬盘驱动器类型              |
| 0x13        | 保留                        |
| 0x14        | 设备字节                    |
| 0x15        | 基本内存 (低字节)           |
| 0x16        | 基本内存 (高字节)           |
| 0x17        | 扩展内存 (低字节)           |
| 0x18        | 扩展内存 (高字节)           |
| 0x19 ~ 0x2d | 保留                        |
| 0x2e        | 校验和 (低字节)             |
| 0x2f        | 校验和 (高字节)             |
| 0x30        | 1Mb 以上的扩展内存 (低字节) |
| 0x31        | 1Mb 以上的扩展内存 (高字节) |
| 0x32        | 当前所处世纪值              |
| 0x33        | 信息标志                    |

## 实时时钟
RTC Real Time Clock
如果要在多少个时钟中断后执行某一操作
- 轮询，时钟中断时不停的检测是否需要执行
- 实时中断

- RTC A
    - 第7位：0->此时没有正在更新，时间信息是安全的；1->此时正处于更新周期
    - 第6~4位：选择的时钟频率，初始010，不用管
    - 第3~0位：控制时间片长度
- RTC B
    - 第7位：0->更新周期每秒都会发生；1->中止更新周期，信息可以安全的访问
    - 第6位：0->不允许周期性中断；1->允许周期性中断
    - 第5位：0->不允许闹钟中断；1->允许闹钟中断
    - 第4位：更新结束中断允许
    - 第3位：方波允许
    - 第2位：数据模式，0->BCD；1->二进制
    - 第1位：小时格式，0->十二小时；1->二十四小时
    - 第0位：过时的夏令时，不管
- RTC C，只读，读了之后可以清除中断，并获取中断因为什么而发生
- RTC D，不管